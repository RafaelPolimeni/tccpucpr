<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
	  xmlns:jsp="http://java.sun.com/JSP/Page"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:a4j="http://richfaces.org/a4j"
	  xmlns:rich="http://richfaces.org/rich"
	  xmlns:validators="validators"
	  xmlns:fn="http://java.sun.com/jsp/jstl/functions">
	<ui:composition template="/templates/main.xhtml">
		<ui:param name="bean" value="#{projetoBean}" />
		<ui:define name="body">
			<a4j:keepAlive beanName="projetoServiceImpl"/>
			<a4j:keepAlive beanName="projetoBean"/>		
			<a4j:form ajaxSubmit="true" id="papelForm" >
				<h:panelGroup layout="block" id="listPanel" rendered="#{projetoServiceImpl.projetoBean.listState}">
					<rich:dataTable value="#{projetoBean.projetos}" var="projeto" 
							width="700" align="center" rows="10" id="projetos" reRender="dataScroller"
							style="white-space: nowrap; overflow: auto;cursor:pointer;" sortMode="single"
							onRowMouseOver="this.style.backgroundColor='#BED6F8'"
        					onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'">
        					
       					<a4j:support action="#{projetoServiceImpl.showDetails}" event="onRowClick">
       						<f:setPropertyActionListener value="#{projeto}" target="#{projetoServiceImpl.projetoBean.projeto}" />
       					</a4j:support>
        
					 	<rich:column sortBy="#{projeto.nome}" style="text-align:left;" >
					 		<f:facet name="header">
								<h:outputText value="#{labels['papel.nome']}" />
							</f:facet>
							<h:outputText value="#{projeto.nome}" width="200"/>
						</rich:column>
						<f:facet name="footer">
               				<rich:datascroller id="dataScroller" />
           				</f:facet>
					</rich:dataTable>
					
					<br />
					
					<a4j:commandButton action="#{projetoServiceImpl.prepareCreate}"
						 value="#{labels['novo']}" style="margin-left:61px;"/>
				</h:panelGroup>
				
				<rich:tabPanel switchType="ajax" rendered="#{not projetoServiceImpl.projetoBean.listState}"
					valueChangeListener="#{projetoServiceImpl.mudarAba}">
			        <rich:tab label="#{labels['projeto.dadosGerais']}" id="tabGeral">
						<h:panelGrid columns="2" >
							<h:outputLabel value="#{labels['projeto.nome']}:" for="nome"/>
							<h:inputText id="nome" value="#{projetoServiceImpl.projetoBean.nome}" 
								rendered="#{projetoServiceImpl.projetoBean.createState or projetoServiceImpl.projetoBean.updateState}"
								maxlength="100" size="80"/>
							<h:outputText value="#{projetoServiceImpl.projetoBean.nome}" 
								rendered="#{projetoServiceImpl.projetoBean.detailState}"/>
							
							<h:outputLabel value="#{labels['projeto.descricao']}:" for="descricao"/>
							<rich:editor id="descricao" width="450" height="250"
								theme="advanced">
								<f:param name="theme_advanced_buttons1" value="bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,|,formatselect,fontselect,fontsizeselect"/>
								<f:param name="theme_advanced_buttons2" value="cut,copy,paste,pastetext,pasteword,|,search,replace,|,bullist,numlist,|,outdent,indent,blockquote,|,undo,redo,|,link,unlink,|,forecolor,backcolor"/>
								<f:param name="theme_advanced_buttons3" value=""/>
								<f:param name="theme_advanced_buttons4" value=""/>
						        <f:param name="theme_advanced_toolbar_location" value="top"/>                               
         						<f:param name="theme_advanced_toolbar_align" value="left"/>
							</rich:editor>
							
							<h:outputLabel value="#{labels['projeto.dataInicio']}:" for="dataInicio" />
							<rich:calendar id="dataInicio" datePattern="dd/MM/yyyy" 
								value="#{projetoServiceImpl.projetoBean.dataInicio}" size="50"
								rendered="#{projetoServiceImpl.projetoBean.createState or projetoServiceImpl.projetoBean.updateState}" />
							<h:outputText value="#{projetoServiceImpl.projetoBean.dataInicio}"
								rendered="#{projetoServiceImpl.projetoBean.detailState}">
								<f:convertDateTime pattern="dd/MM/yyyy" />
							</h:outputText>
							
							<h:outputLabel value="#{labels['projeto.dataFimPrevista']}:" for="dataFimPrevista" />
							<rich:calendar id="dataFimPrevista" datePattern="dd/MM/yyyy" 
								value="#{projetoServiceImpl.projetoBean.dataFimPrevista}" size="50"
								rendered="#{projetoServiceImpl.projetoBean.createState or projetoServiceImpl.projetoBean.updateState}"/>
							<h:outputText value="#{projetoServiceImpl.projetoBean.dataFimPrevista}"
								rendered="#{projetoServiceImpl.projetoBean.detailState}">
								<f:convertDateTime pattern="dd/MM/yyyy" />
							</h:outputText>
							<h:outputText value=" " />
						</h:panelGrid>
						
						<br />
			        </rich:tab>
			        <rich:tab label="#{labels['projeto.observadores']}" id="tabObservadores">
			        	<h:outputFormat value="#{labels['projeto.selecione']}" styleClass="pageMessage">
			        		<f:param value="#{fn:toLowerCase(labels['projeto.observadores'])}"/>
			        	</h:outputFormat>
			        	
			        	<br />
			        	<br />
			        	
				        <rich:extendedDataTable id="possiveisObservadores" var="item"
							value="#{projetoServiceImpl.projetoBean.possiveisObservadores}"
							selectionMode="multiple" height="200px" style="cursor: pointer;"
							selection="#{projetoServiceImpl.projetoBean.selecaoObservadores}">
							
							<rich:column width="100%" label="Nome" sortable="true" sortBy="#{item.nome}" id="nomeObservadoresPossiveis">
								<f:facet name="header">
									Nome
								</f:facet>
								<h:outputText value="#{item.nome} #{item.sobrenome}"></h:outputText>	
							</rich:column>
			            </rich:extendedDataTable>
						
						<br />
						
						<a4j:commandButton actionListener="#{projetoServiceImpl.selecionarObservadores}" 
							value="#{labels['selecionar']}" reRender="observadores"/>
						
						<br />
						<br />
						<br />
						
						<h:panelGroup rendered="#{not empty projetoServiceImpl.projetoBean.observadores}">
							<h:outputText value="Observadores Selecionados" styleClass="pageMessage"/>
			        	
				        	<br />
				        	<br />
						</h:panelGroup>
			        	
						<rich:extendedDataTable id="observadoresSelecionados" var="item"
							value="#{projetoServiceImpl.projetoBean.observadores}"
							rendered="#{not empty projetoServiceImpl.projetoBean.observadores}"
							selectionMode="none" height="200px">
							
							<rich:column width="90%" sortable="true" sortBy="#{item.nome}" label="Nome">
								<f:facet name="header">
									Nome
								</f:facet>
								<h:outputText value="#{item.nome} #{item.sobrenome}"></h:outputText>	
							</rich:column>
							
							<rich:column style="text-align: center;" label="Excluir" width="10%">
								<f:facet name="header">
									Excluir											
								</f:facet>
								<h:graphicImage value="/img/disabled.png" style="cursor: pointer;">
									<a4j:support action="#{projetoServiceImpl.excluirObservador}"
										event="onclick" immediate="true">
										<f:setPropertyActionListener value="#{item}" target="#{projetoServiceImpl.projetoBean.recursoTemp}" />
									</a4j:support>
								</h:graphicImage>
							</rich:column>
			            </rich:extendedDataTable>
			            
			            <h:outputFormat value="#{labels['projeto.nenhumSelecionado']}" rendered="#{empty projetoServiceImpl.projetoBean.observadores}">
			            	<f:param value="#{fn:toLowerCase(labels['projeto.observador'])}"/>
			            </h:outputFormat>
			        </rich:tab>
			        
			        <rich:tab label="#{labels['projeto.gerentes']}" id="tabGerentes">
			        	<h:outputFormat value="#{labels['projeto.selecione']}" styleClass="pageMessage">
			        		<f:param value="#{fn:toLowerCase(labels['projeto.gerentes'])}"/>
			        	</h:outputFormat>
			        	
			        	<br />
			        	<br />
			        	
				        <rich:extendedDataTable id="possiveisGerentes" var="item"
							value="#{projetoServiceImpl.projetoBean.possiveisGerentes}"
							selectionMode="multiple" height="200px" style="cursor: pointer;"
							selection="#{projetoServiceImpl.projetoBean.selecaoGerentes}">
							
							<rich:column width="100%" label="Nome" sortable="true" sortBy="#{item.nome}" id="nomeGerentesPossiveis">
								<f:facet name="header">
									Nome
								</f:facet>
								<h:outputText value="#{item.nome} #{item.sobrenome}"></h:outputText>	
							</rich:column>
			            </rich:extendedDataTable>
						
						<br />
						
						<a4j:commandButton actionListener="#{projetoServiceImpl.selecionarGerentes}" 
							value="#{labels['selecionar']}"/>
						
						<br />
						<br />
						
						<rich:extendedDataTable id="gerentesSelecionados" var="item"
							value="#{projetoServiceImpl.projetoBean.gerentes}"
							rendered="#{not empty projetoServiceImpl.projetoBean.gerentes}"
							selectionMode="none" height="200px">
							
							<rich:column width="90%" sortable="true" sortBy="#{item.nome}" label="Nome">
								<f:facet name="header">
									Nome
								</f:facet>
								<h:outputText value="#{item.nome} #{item.sobrenome}"></h:outputText>	
							</rich:column>
							
							<rich:column style="text-align: center;" label="Excluir" width="10%">
								<f:facet name="header">
									Excluir											
								</f:facet>
								<h:graphicImage value="/img/disabled.png" style="cursor: pointer;">
									<a4j:support action="#{projetoServiceImpl.excluirGerente}"
										event="onclick" immediate="true">
										<f:setPropertyActionListener value="#{item}" target="#{projetoServiceImpl.projetoBean.recursoTemp}" />
									</a4j:support>
								</h:graphicImage>
							</rich:column>
			            </rich:extendedDataTable>
			            
			            <h:outputFormat value="#{labels['projeto.nenhumSelecionado']}" rendered="#{empty projetoServiceImpl.projetoBean.gerentes}">
			            	<f:param value="#{fn:toLowerCase(labels['projeto.gerente'])}"/>
			            </h:outputFormat>
			        </rich:tab>
			        
			        <rich:tab label="#{labels['projeto.recursos']}" id="tabRecursos">
			        	<h:outputFormat value="#{labels['projeto.selecione']}" styleClass="pageMessage">
			        		<f:param value="#{fn:toLowerCase(labels['projeto.recursos'])}"/>
			        	</h:outputFormat>
			        	
			        	<br />
			        	<br />
			        	
				        <rich:extendedDataTable id="possiveisRecursos" var="item"
							value="#{projetoServiceImpl.projetoBean.possiveisRecursos}"
							selectionMode="multiple" height="200px" style="cursor: pointer;"
							selection="#{projetoServiceImpl.projetoBean.selecaoRecursos}"
							rowKeyVar="index">
							
							<rich:column width="60%" label="Nome" sortable="true" sortBy="#{item.nome}">
								<f:facet name="header">
									Nome
								</f:facet>
								<h:outputText value="#{item.nome} #{item.sobrenome}" />	
							</rich:column>
							<rich:column width="40%" label="Papel">
								<f:facet name="header">
									Papel
								</f:facet>
								<rich:comboBox defaultLabel="Selecione um papel" value="#{item.papelProjeto}">
									<f:selectItems value="#{projetoServiceImpl.papeis}" />
								</rich:comboBox>
							</rich:column>
			            </rich:extendedDataTable>
						
						<br />
						
						<a4j:commandButton actionListener="#{projetoServiceImpl.selecionarRecursos}" 
							value="#{labels['selecionar']}"/>
						
						<br />
						<br />
						
						<rich:extendedDataTable id="recursosSelecionados" var="item"
							value="#{projetoServiceImpl.projetoBean.recursos}"
							rendered="#{not empty projetoServiceImpl.projetoBean.recursos}"
							selectionMode="none" height="200px">
							
							<rich:column width="59%" sortable="true" sortBy="#{item.nome}" label="Nome">
								<f:facet name="header">
									Nome
								</f:facet>
								<h:outputText value="#{item.recursoProjetoPK.recurso.nome} #{item.recursoProjetoPK.recurso.sobrenome}"></h:outputText>	
							</rich:column>
							
							<rich:column width="31%" sortable="true" sortBy="#{item.nome}" label="Nome">
								<f:facet name="header">
									Papel
								</f:facet>
								<h:outputText value="#{item.papel.nome}"></h:outputText>	
							</rich:column>
							
							<rich:column style="text-align: center;" label="Excluir" width="10%">
								<f:facet name="header">
									Excluir											
								</f:facet>
								<h:graphicImage value="/img/disabled.png" style="cursor: pointer;">
									<a4j:support action="#{projetoServiceImpl.excluirRecurso}"
										event="onclick" immediate="true">
										<f:setPropertyActionListener value="#{item}" target="#{projetoServiceImpl.projetoBean.recursoProjetoTemp}" />
									</a4j:support>
								</h:graphicImage>
							</rich:column>
			            </rich:extendedDataTable>
			            
			            <h:outputFormat value="#{labels['projeto.nenhumSelecionado']}" rendered="#{empty projetoServiceImpl.projetoBean.recursos}">
			            	<f:param value="#{fn:toLowerCase(labels['projeto.recurso'])}"/>
			            </h:outputFormat>
			        </rich:tab>
			    </rich:tabPanel>
			    
			    <br />
			    
			    <a4j:commandButton actionListener="#{projetoServiceImpl.confirmCreate}" value="#{labels['confirmar']}" rendered="#{projetoServiceImpl.projetoBean.createState}" reRender="messageSenha"/>
				<a4j:commandButton action="#{projetoServiceImpl.prepareUpdate}" value="#{labels['alterar']}" rendered="#{projetoServiceImpl.projetoBean.detailState}"/>
				<a4j:commandButton action="#{projetoServiceImpl.confirmUpdate}" value="#{labels['confirmar']}" rendered="#{projetoServiceImpl.projetoBean.updateState}"/>
				<rich:spacer width="7" rendered="#{not projetoServiceImpl.projetoBean.listState}"/>
				<a4j:commandButton action="#{projetoServiceImpl.backToList}" value="#{labels['cancelar']}" rendered="#{not projetoServiceImpl.projetoBean.listState}" immediate="true"/>
			</a4j:form>
		</ui:define>
	</ui:composition>
</html>