<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
	  xmlns:jsp="http://java.sun.com/JSP/Page"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:a4j="http://richfaces.org/a4j"
	  xmlns:rich="http://richfaces.org/rich"
	  xmlns:validators="validators">
	<ui:composition template="/templates/main.xhtml">
		<ui:param name="bean" value="#{projetoBean}" />
		<ui:define name="body">
			<a4j:keepAlive beanName="projetoServiceImpl"/>
			<a4j:keepAlive beanName="projetoBean"/>		
			<a4j:form ajaxSubmit="true" id="papelForm" >
				<h:panelGroup layout="block" id="listPanel" rendered="#{projetoServiceImpl.projetoBean.listState}">
					<rich:dataTable value="#{projetoBean.projetos}" var="projeto" 
							width="700" align="center" rows="10" id="projetos" reRender="dataScroller"
							style="white-space: nowrap; overflow: auto;cursor:pointer;" sortMode="single"
							onRowMouseOver="this.style.backgroundColor='#BED6F8'"
        					onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'">
        					
       					<a4j:support action="#{projetoServiceImpl.showDetails}" event="onRowClick">
       						<f:setPropertyActionListener value="#{projeto}" target="#{projetoServiceImpl.projetoBean.projeto}" />
       					</a4j:support>
        
					 	<rich:column sortBy="#{projeto.nome}" style="text-align:left;" >
					 		<f:facet name="header">
								<h:outputText value="#{labels['papel.nome']}" />
							</f:facet>
							<h:outputText value="#{projeto.nome}" width="200"/>
						</rich:column>
						<f:facet name="footer">
               				<rich:datascroller id="dataScroller" />
           				</f:facet>
					</rich:dataTable>
					
					<br />
					
					<a4j:commandButton action="#{projetoServiceImpl.prepareCreate}"
						 value="#{labels['novo']}" style="margin-left:61px;"/>
				</h:panelGroup>
				
				<h:panelGroup layout="block" id="detailPanel" 
					rendered="#{not projetoServiceImpl.projetoBean.listState}">
					<fieldset>
						<legend>Dados do projeto</legend>
						
						<h:panelGrid columns="3" >
							<h:outputLabel value="#{labels['projeto.nome']}:" for="nome"/>
							<h:inputText id="nome" value="#{projetoServiceImpl.projetoBean.nome}" 
								rendered="#{projetoServiceImpl.projetoBean.createState or projetoServiceImpl.projetoBean.updateState}"
								required="true" requiredMessage="#{messages['validation.empty']}"
								maxlength="100" size="80">
								<f:validator validatorId="validaObrigatorio"/>
								<rich:ajaxValidator event="onsubmit"/>
							</h:inputText>
							<h:outputText value="#{projetoServiceImpl.projetoBean.nome}" 
								rendered="#{projetoServiceImpl.projetoBean.detailState}"/>
							<rich:message for="nome" style="color:red;"/>
							
							<h:outputLabel value="#{labels['projeto.descricao']}:" for="descricao"/>
							<rich:editor id="descricao" width="450" height="250"
								theme="advanced" required="true" 
								requiredMessage="#{messages['validation.empty']}">
								<f:param name="theme_advanced_buttons1" value="bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,|,formatselect,fontselect,fontsizeselect"/>
								<f:param name="theme_advanced_buttons2" value="cut,copy,paste,pastetext,pasteword,|,search,replace,|,bullist,numlist,|,outdent,indent,blockquote,|,undo,redo,|,link,unlink,|,forecolor,backcolor"/>
								<f:param name="theme_advanced_buttons3" value=""/>
								<f:param name="theme_advanced_buttons4" value=""/>
						        <f:param name="theme_advanced_toolbar_location" value="top"/>                               
         							<f:param name="theme_advanced_toolbar_align" value="left"/>
							</rich:editor>
							<rich:message for="descricao" style="color:red;"/>
							
							<h:outputLabel value="#{labels['projeto.dataInicio']}:" for="dataInicio" />
							<rich:calendar id="dataInicio" datePattern="dd/MM/yyyy" 
								value="#{projetoServiceImpl.projetoBean.dataInicio}" 
								rendered="#{projetoServiceImpl.projetoBean.createState or projetoServiceImpl.projetoBean.updateState}"
								required="true" requiredMessage="#{messages['validation.empty']}"
								size="50">
								<rich:ajaxValidator event="onsubmit"/>
							</rich:calendar>
							<h:outputText value="#{projetoServiceImpl.projetoBean.dataInicio}"
								rendered="#{projetoServiceImpl.projetoBean.detailState}">
								<f:convertDateTime pattern="dd/MM/yyyy" />
							</h:outputText>
							<rich:message for="dataInicio" style="color:red;"/>
							
							<h:outputLabel value="#{labels['projeto.dataFimPrevista']}:" for="dataFimPrevista" />
							<rich:calendar id="dataFimPrevista" datePattern="dd/MM/yyyy" 
								value="#{projetoServiceImpl.projetoBean.dataFimPrevista}" size="50"
								rendered="#{projetoServiceImpl.projetoBean.createState or projetoServiceImpl.projetoBean.updateState}">
								<rich:ajaxValidator event="onsubmit"/>
							</rich:calendar>
							<h:outputText value="#{projetoServiceImpl.projetoBean.dataFimPrevista}"
								rendered="#{projetoServiceImpl.projetoBean.detailState}">
								<f:convertDateTime pattern="dd/MM/yyyy" />
							</h:outputText>
							<rich:message for="dataFimPrevista" style="color:red;"/>
							
							<h:outputLabel value="#{labels['projeto.observadores']}:" for="observadores" />
							<rich:dataTable id="observadores" var="item" rows="4"
								value="#{projetoServiceImpl.projetoBean.observadores}">
								<rich:column>
									<f:facet name="header">
										Nome
									</f:facet>
									<h:outputText value="#{item.nome} #{item.sobrenome}"></h:outputText>	
								</rich:column>
								
								<rich:column style="text-align: center;">
									<f:facet name="header">
																					
									</f:facet>
									<h:graphicImage value="/img/disabled.png" style="cursor: pointer;">
										<a4j:support action="#{projetoServiceImpl.excluirObservador}"
											event="onclick" immediate="true">
											<f:setPropertyActionListener value="#{item}" target="#{projetoServiceImpl.projetoBean.recursoTemp}" />
										</a4j:support>
									</h:graphicImage>
								</rich:column>
								<f:facet name="footer">
				            		<rich:datascroller id="dataScroller2" />
				            	</f:facet>
				            </rich:dataTable>
							<rich:message for="observadores" style="color:red;"/>
							
							<h:outputText value=" " />
							
							<a4j:commandButton action="#{projetoServiceImpl.mostrarModalObservadores}" 
									value="#{labels['adicionar']}" immediate="true"/>
							<h:outputText value=" " />
						</h:panelGrid>
						
						<br />
						
						<a4j:commandButton action="#{projetoServiceImpl.confirmCreate}" value="#{labels['confirmar']}" rendered="#{projetoServiceImpl.projetoBean.createState}" reRender="messageSenha"/>
						<a4j:commandButton action="#{projetoServiceImpl.prepareUpdate}" value="#{labels['alterar']}" rendered="#{projetoServiceImpl.projetoBean.detailState}"/>
						<a4j:commandButton action="#{projetoServiceImpl.confirmUpdate}" value="#{labels['confirmar']}" rendered="#{projetoServiceImpl.projetoBean.updateState}"/>
						<rich:spacer width="7" rendered="#{not projetoServiceImpl.projetoBean.listState}"/>
						<a4j:commandButton action="#{projetoServiceImpl.backToList}" value="#{labels['cancelar']}" rendered="#{not projetoServiceImpl.projetoBean.listState}" immediate="true"/>
					</fieldset>
				</h:panelGroup>
			</a4j:form>
			
			<rich:modalPanel id="modalPanelObserver" rendered="#{projetoServiceImpl.projetoBean.showModalObservadores}" 
				autosized="true" showWhenRendered="true" width="450">
				<f:facet name="header">
					<h:outputText value="#{labels['projeto.observadores']}" />
				</f:facet>
					
				<a4j:form id="modalFormObservadores" ajaxSubmit="true" reRender="nome">
					<rich:extendedDataTable id="possiveisObservadores" var="item" rows="6"
						value="#{projetoServiceImpl.projetoBean.possiveisObservadores}"
						selectionMode="multiple" height="200px" style="cursor: pointer;"
						selection="#{projetoServiceImpl.projetoBean.selecaoObservadores}">
						<rich:column>
							<f:facet name="header">
								Nome
							</f:facet>
							<h:outputText value="#{item.nome} #{item.sobrenome}"></h:outputText>	
						</rich:column>
						
						<f:facet name="footer">
		            		<rich:datascroller id="dataScrollerObservadores" />
		            	</f:facet>
		            </rich:extendedDataTable>
					
					<br />
					
					<a4j:commandButton action="#{projetoServiceImpl.selecionarObservadores}" 
						value="#{labels['selecionar']}" reRender="observadores"/>
					<rich:spacer width="7"/>
					<a4j:commandButton action="#{projetoServiceImpl.esconderModalObservadores}" 
						value="#{labels['cancelar']}" reRender="observadores"/>
				</a4j:form>		
			</rich:modalPanel>
		</ui:define>
	</ui:composition>
</html>